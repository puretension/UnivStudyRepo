### 스레드
[혼자 공부하는 컴퓨터구조+운영체제(저자 강민철)](https://www.yes24.com/Product/Goods/111378840)과 [유튜브 강의](https://www.youtube.com/watch?v=isj4sZhoxjk&list=PLYH7OjNUOWLUz15j4Q9M6INxK5J3-59GC&index=2)를 보고 정리한 글입니다. 

- 스레드란 `프로세스를 구성하는 실행흐름의 단위`
- 하나의 프로세스는 하나 이상의 스레드를 가질 수 있음
- 단일 스레드 프로세스: 하나의 실행 흐름(스레드)을 가져, 한번에 한 부분만 실행되는 프로세스
- 멀티 스레드 프로세스: 실행흐름이 여러개인 프로세스

### 단일과 멀티 차이점? → 멀티 스레드 프로세스는 프로세스를 이루는 여러 명령어 동시 실행 가능

![스크린샷 2024-03-05 오후 4 10 08](https://github.com/puretension/UnivStudyRepo/assets/106448279/88f85e0b-2df9-4806-aba3-ae142192ba24)


### 스레드의 특징

- 스레드는 각기다른 **스레드 ID, 프로그램 카운터(PC)를 비롯한 레지스터 값, 스택** 등으로 구성
- 각 스레드는 서로 다른 코드를 동시에 실행할 수 있음
- `실행에 필요한 최소한의 정보(레지스터, 스택)`만 분리한 채 프로세스 자원을 공유하며 실행됨
- 최근에 많은 운영체제는 CPU에 처리할 작업단위를 스레드 단위로 전달함

### 리눅스에서의 프로세스와 스레드(번외)

- 리눅스에서는 프로세스와 스레드를 구분짓지 않음
- 둘 모두 실행의 문맥(context of execution) 관점에서 동등하다고 간주함
- 프로세스와 스레드보다는 task라는 이름으로 통일해 명명함

![스크린샷 2024-03-05 오후 4 10 28](https://github.com/puretension/UnivStudyRepo/assets/106448279/32fd031a-9c05-4281-af47-6299f5cf1e07)

## 멀티 프로세스와 멀티 스레드

- 멀티프로세스(multiprocess): (동일한 작업을 수행하는데) 여러 프로세스를 실행(여러 프로세스로 병행 실행)
- 멀티스레드(multithread): (동일한 작업을 수행하는데) 여러 스레드로 하나의 프로세스를 진행(하나의 프로세스로 병행 실행)

#### (그림참고)
![스크린샷 2024-03-05 오후 4 11 42](https://github.com/puretension/UnivStudyRepo/assets/106448279/4d1a0e41-4739-4905-99ae-3e94b1d749d7)

#### 스레드, 단일프로세스 VS 멀티프로세스, 멀티프로세스 VS 멀티스레드 이해한거면 됨✅

#### 멀티프로세스
![스크린샷 2024-03-05 오후 4 11 48](https://github.com/puretension/UnivStudyRepo/assets/106448279/811d504b-3bb3-47aa-ad26-2990e84745eb)

#### 멀티스레드 
![스크린샷 2024-03-05 오후 4 11 54](https://github.com/puretension/UnivStudyRepo/assets/106448279/8bee9d44-8176-4627-9f4c-ae41a8455789)

### 멀티프로세스와 멀티스레드의 차이

#### 멀티프로세스는 프로세스간 자원을 공유하지 않지만, 멀티스레드는 같은 프로세스 내의 자원을 공유한다.

#### 멀티프로세스
- 동일 작업을 하는 프로세스의 경우, fork를 통해 모든 자원을 복제해 메모리에 적재한다. 즉, 동일한 프로세스 두 개가 각각 메모리에 적재된다

#### 멀티스레드
- 프로세스가 가진 자원을 공유한다.
- 스레드간 차이는 스레드 ID, 프로그램 카운터를 포함한 레지스터 값, 스택만 차이를 가진다.

### 멀티 프로세스와 멀티 스레드의 장단점

#### 멀티프로세스 장점
- 각 프로세스간 `독립적`이기 때문에 하나의 프로세스에 문제가 생겨도 영향이 적다.

#### 멀티프로세스 단점
- 동일한 프로그램 실행을 위해 메모리에 같은 내용이 중복돼 적재되기 때문에 `메모리 낭비`로 볼 수 있다.
- 자원을 공유하지 않기 때문에 서로 독립적으로 실행된다.

#### 멀티스레드 장점
- 여러 프로세스를 병행실행하는 것보다 메모리를 효율적으로 사용한
- 스레드간 협력과 통신에 유리하다.

#### 멀티스레드 단점
- 스레드간 같은 자원을 공유하기 때문에 하나의 프로세스에서 발생한 문제가 전체 스레드에 영향을 줄 수 있다.

### 프로세스 간 통신(IPC; Inter-Process Communication)
- 원래는 프로세스끼리는 자원을 공유하지 않는다 But.
- 프로세스 간에도 자원을 주고받을 수 있다 -> 프로세스 간 통신(IPC)
    - `파일`을 통한 프로세스 간 통신: 여러 프로세스가 동일 파일에 접근할 시, 해당 파일의 데이터를 통해 프로세스 간 통신이 이루어진다
    - `공유 메모리`를 통한 프로세스 간 통신: 프로세스간 서로 공유하는 메모리 영역으로 공유 메모리를 통해 프로세스간 데이터를 주고 받는다.
    - 이외에도 프로세스들은 소켓, 파이프 등을 통해 통신
- 단, 스레드에 비해 자원 공유는 까다롭다.

---------

### 3. 프로세스가 무엇인가요?
- 프로그램과 프로세스, 스레드의 차이에 대해 설명해 주세요.
- PCB가 무엇인가요?
- 그렇다면, 스레드는 PCB를 갖고 있을까요?
- 리눅스에서, 프로세스와 스레드는 각각 어떻게 생성될까요?
- 자식 프로세스가 상태를 알리지 않고 죽거나, 부모 프로세스가 먼저 죽게 되면 어떻게 처리하나요?
- 리눅스에서, 데몬프로세스에 대해 설명해 주세요.
- 리눅스는 프로세스가 일종의 트리를 형성하고 있습니다. 이 트리의 루트 노드에 위치하는 프로세스에 대해 설명해 주세요.


### 4. 프로세스 주소공간에 대해 설명해 주세요.
- 초기화 하지 않은 변수들은 어디에 저장될까요?
- 일반적인 주소공간 그림처럼, Stack과 Heap의 크기는 매우 크다고 할 수 있을까요? 그렇지 않다면, 그 크기는 언제 결정될까요?
- Stack과 Heap 공간에 대해, 접근 속도가 더 빠른 공간은 어디일까요?
- 다음과 같이 공간을 분할하는 이유가 있을까요?
- 스레드의 주소공간은 어떻게 구성되어 있을까요?
- "스택"영역과 "힙"영역은 정말 자료구조의 스택/힙과 연관이 있는 걸까요? 만약 그렇다면, 각 주소공간의 동작과정과 연계해서 설명해 주세요.
- IPC의 Shared Memory 기법은 프로세스 주소공간의 어디에 들어가나요? 그런 이유가 있을까요?
- 스택과 힙영역의 크기는 언제 결정되나요? 프로그램 개발자가 아닌, 사용자가 이 공간의 크기를 수정할 수 있나요?

### 3. 프로세스란?

프로세스는 실행 중인 프로그램의 인스턴스로, 운영 체제로부터 자원을 할당받아 작업을 수행합니다. 메모리, CPU 시간, I/O 등 필요한 자원과 실행 상태 정보를 포함합니다.

### 프로그램, 프로세스, 스레드 차이

- **프로그램**: 저장 장치에 저장되어 있으며 실행되지 않는 정적인 코드와 데이터의 집합입니다.
- **프로세스**: 프로그램이 실행되어 시스템 자원을 할당받은 상태입니다. 독립적인 메모리 공간을 가지며, 최소 하나의 스레드를 포함합니다.
- **스레드**: 프로세스 내에서 실행되는 실행 단위로, 프로세스의 자원을 공유하며 작업을 수행합니다. 스레드는 프로세스 내에서 코드, 데이터, 힙 영역을 공유하면서 각자의 스택을 가지고 실행됩니다.

### PCB(Process Control Block)

PCB는 특정 프로세스에 대한 중요 정보를 저장하는 운영 체제의 자료구조입니다. 프로세스 상태, 프로그램 카운터, 레지스터 값, 메모리 관리 정보, 계정 정보 등이 포함됩니다.

### 스레드와 PCB

스레드는 독립적인 PCB를 갖지 않습니다. 대신, 같은 프로세스 내의 스레드들은 해당 프로세스의 PCB를 공유하며, 각 스레드는 자신만의 스택과 프로그램 카운터를 가지고 실행됩니다.

### 리눅스에서의 프로세스와 스레드 생성

- **프로세스 생성**: `fork()` 시스템 콜을 사용하여 현재 프로세스의 복사본인 자식 프로세스를 생성합니다.
- **스레드 생성**: `pthread_create()` 함수를 사용하여 같은 프로세스 내에서 실행되는 새로운 스레드를 생성합니다.

### 고아 프로세스와 좀비 프로세스 처리

- **고아 프로세스**: 부모 프로세스가 먼저 종료되면, 고아 프로세스는 init 프로세스의 자식이 되어 init 프로세스가 종료를 관리합니다.
- **좀비 프로세스**: 자식 프로세스가 종료되었으나 부모 프로세스가 종료 상태를 회수하지 않아 메모리에 남아 있는 상태입니다. 부모 프로세스가 `wait()`를 호출하여 자식 프로세스의 종료 상태를 회수하면 좀비 프로세스는 제거됩니다.

### 데몬 프로세스

데몬 프로세스는 사용자의 직접적인 개입 없이 백그라운드에서 실행되는 프로세스입니다. 시스템 로깅, 스케줄링 작업, 네트워크 요청 처리 등을 담당합니다.

### 리눅스 프로세스 트리와 루트 노드

리눅스 시스템에서 모든 프로세스는 트리 구조를 형성하며, 이 트리의 루트 노드는 PID가 1인 `init` 프로세스 또는 `systemd` 프로세스입니다. 시스템 부팅 시 가장 먼저 실행되며, 다른 모든 사용자 프로세스의 부모 역할을 합니다.

### 프로세스 주소공간

프로세스 주소공간은 코드(프로그램 코드), 데이터(전역 변수),

 힙(동적 할당 데이터), 스택(함수 호출 및 지역 변수)으로 구성됩니다.

- **초기화되지 않은 변수**: `.bss` 세그먼트에 저장됩니다.
- **스택과 힙의 크기**: 일반적으로 제한적이며, 프로세스 실행 중 동적으로 조정될 수 있습니다. 운영 체제와 프로그램의 메모리 관리 정책에 따라 결정됩니다.
- **접근 속도**: 스택의 접근 속도가 힙보다 일반적으로 빠릅니다. 스택은 LIFO(후입선출) 구조로 되어 있어 최근 데이터에 빠르게 접근할 수 있습니다.
- **공간 분할 이유**: 메모리 관리의 효율성과 유연성을 높이기 위해서입니다. 스택은 함수 호출과 반환에 사용되며, 힙은 동적 메모리 할당에 사용됩니다.
- **스레드 주소공간**: 같은 프로세스 내의 스레드들은 코드, 데이터, 힙 영역을 공유하면서 각자의 스택을 가지고 있습니다.
- **스택과 힙의 자료구조 연관성**: 주소 공간의 스택과 힙은 자료구조의 스택과 힙과 개념적으로 유사합니다. 스택은 함수의 호출과 지역 변수에 사용되는 LIFO 구조, 힙은 동적으로 할당되는 데이터를 저장하는 공간입니다.
- **IPC의 Shared Memory**: 프로세스 간 공유 메모리는 데이터를 공유하기 위한 방법으로, 주소 공간 내의 특정 영역에 매핑됩니다. 이는 프로세스 간 통신을 위해 효율적으로 데이터를 공유할 수 있게 합니다.
- **스택과 힙 영역 크기 결정 시점**: 프로그램 실행 시 운영 체제에 의해 초기 크기가 결정되며, 필요에 따라 동적으로 조정될 수 있습니다. 일반적으로 사용자가 직접 크기를 조정할 수 있는 방법은 제한적입니다.
