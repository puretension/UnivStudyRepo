# 1.1 교착 상태

[혼자 공부하는 컴퓨터구조+운영체제(저자 강민철)](https://www.yes24.com/Product/Goods/111378840)과 [유튜브 강의](https://www.youtube.com/watch?v=isj4sZhoxjk&list=PLYH7OjNUOWLUz15j4Q9M6INxK5J3-59GC&index=2)를 보고 정리한 글입니다. 

### 교착상태(deadlock)

- 두개 이상의 프로세스가 서로가 원하는 자원을 점유하고 있어 서로의 종료만을 기다리는 상황
- **식사하는 철학자 문제**로 쉽게 이해 가능

### **자원 할당 그래프 (resource-allocation graph, RAG)**

그래프 작성 규칙

- 프로세스는 원으로, 자원은 사각형으로 표현
- 사용가능한 자원 개수는 자원 사각형 내 점으로 표현
- 프로세스가 어떤 자원을 사용중이라면 자원에서 프로세스 방향으로 화살표 표시
- 아래이미지 설명
    - SSD는 자원 개수 3개 CPU는 2개 프린터는 1개
    - 프로세스 A는 SSD 사용
    - 프로세스 B와 C는 CPU 사용
    - 프로세스 D는 프린터 사용
    - 프로세스 E는 프린터 사용 요청
    - 프로세스 F는 CPU 사용 요청

![스크린샷 2024-03-08 오후 12 56 19](https://github.com/puretension/UnivStudyRepo/assets/106448279/73dcc4fb-126e-4b26-987e-d7721ec6ac7d)

- 교착 상태는 자원 할당 그래프가 원의 형태를 띌 때 발생한다.

![스크린샷 2024-03-08 오후 12 56 23](https://github.com/puretension/UnivStudyRepo/assets/106448279/3acf5579-2bf3-4794-88d4-7b4803edde22)

### 교착 상태의 4가지 발생 조건

- 상호 배제(mutual exclusion)
    - 한 프로세스가 사용하는 자원을 다른 프로세스가 `사용할 수 없는` 상태
- 점유와 대기(hold and wait)
    - 자원을 할당받은 상태에서 다른 자원의 할당을 `(무작정) 기다리는` 상태(다른 프로세스 작업이 끝나야함)
- 비선점(nonpreemptive)
    - 어떤 프로세스도 다른 프로세스의 자원을 `강제로 뺏지 못하는` 상태
- 원형대기(circular wait)
    - 프로세스들이 원형 형태로 자원을 대기하는 상태

위 4가지 조건이 `모두 만족`해야 교착상태 발생함

# 1.2 교착상태 해결 방법

- 예방
- 회피
- 검출 후 회복

## 1.2.1 교착 상태 예방

- 교착 상태 발생 조건 4가지 중 1가지를 충족하지 못하게 하는 방법
- 교착상태 방지를 보장할 수는 있으나, 부작용이 따르는 방식

### 1. 자원의 상호 배제 예방

- 모든 자원을 shareable 하게 만든다
- 한계: 이론적으로는 교착상태 방지 가능하나, 현실적으로 모든자원의 상호배제는 어렵다

### 2. 점유와 대기 예방

- 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분 → 자원의 활용율 낮추는 방식
- 한계: 자원 활용률이 낮아질 우려가 있고, 많은 자원을 사용하는 프로세스가 불리해진다.

### 3. 비선점 조건 예방

- 자원을 이용중인 프로세스로부터 해당 자원을 빼앗는다
- 선점가능한 일부 자원에 효과적
- 한계: 모든 자원이 선점 가능한게 아니다

### 4. 원형 대기 조건 예방

- 모든 자원에 번호를 붙이고(인덱싱)  오름차순으로 자원할당시 원형대기 방지 가능함
- 한계: 모든 자원에 번호를 붙이기가 어렵고, 어떤 자원에 번호붙이느냐에따라 활용도가 달라짐

## 1.2.2 교착 상태 회피

- 교착상태 발생원인은 `무분별한 자원 할당`으로 간주
- 배분할 수 있는 자원의 양을 고려해서 교착상태가 발생하지 않을 만큼만 자원 배분

### 안전 상태와 불안전 상태

- 안전 상태(safe state)
    - 교착 상태가 발생하지 않게 모든 프로세스가 정상적으로 자원 할당 및 종료될 수 있는 상태
    - 안전 순서열이 있는 상태를 안전상태라고 부름
    - 안전 순서열(safe sequence): 교착 상태없이 안전하게 프로세스들에 자원 할당 가능한 순서
        
        ![스크린샷 2024-03-08 오후 12 56 30](https://github.com/puretension/UnivStudyRepo/assets/106448279/6ae3acb9-a8ba-46a6-988b-56459d048291)
      
- 불안전 상태(unsafe state)
    - 교착상태 발생 가능한 상황
    - 안전순서열이 없는 상황
        
        ![스크린샷 2024-03-08 오후 12 56 34](https://github.com/puretension/UnivStudyRepo/assets/106448279/2aece0ab-5053-423c-a359-f21309b44f13)

### 운영체제의 교착 상태 회피

- 안전 상태에서 안전상태로 움직이는 경우에만 자원할당하는 방식
- 항시 안전상태 유지하도록 자원할당하는 방식
- **은행원 알고리즘**(**Banker's Algorithm**)

## 1.2.2 교착 상태 검출 후 회복

- 교착 상태 발생 확인후에 사후에 조치하는 방식
- 프로세스가 자원을 요구하면 일단 할당, 교착 상태가 검출되면 회복
- `선점을 통한 회복`과 `프로세스 강제 종료를 통한 회복` 2가지 존재

### 선점을 통한 회복

- 교착상태가 해결될때까지 한 프로세스씩 자원을 몰아주는 방식

### 프로세스 강제종료를 통한 회복

- 교착상태에 놓인 프로세스 모두 강제종료(작업 내용을 잃을 위험)
- 교착상태가 해결될때까지 한 프로세스씩 강제종료(오버헤드)
